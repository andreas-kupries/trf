# -*- tcl -*-
# Commands covered:  transform
#
# This file contains a collection of tests for one or more of the trf
# commands of the TRF extension. Sourcing this file into Tcl runs the
# tests and generates output for errors.  No output means no errors were
# found.
#
# Copyright (c) 1997 Andreas Kupries (a.kupries@westend.com)
#
# See the file "license.terms" for information on usage and redistribution
# of this file, and for a DISCLAIMER OF ALL WARRANTIES.
#
# $Id$

if {[string compare test [info procs test]] == 1} then {source defs}


proc identity {operation buffer} {
    global  tracevar
    lappend tracevar "${operation}-[string length $buffer]"

    # no changes!
    set     buffer
}


test transform-1.0 {transform behaviour, immediate write} {
    set     tracevar ""
    lappend tracevar [transform -mode write -command identity foobarflabbergast]
    set     tracevar
} {}


test transform-1.1 {transform behaviour, immediate read} {
    set     tracevar ""
    lappend tracevar [transform -mode write -command identity foobarflabbergast]
    set     tracevar
} {}


test transform-2.0 {transform behaviour, attached write} {
    set tracevar ""
    set                out [memchan]
    transform -attach $out -command identity
    puts              $out foobarflabbergast
    close             $out

    set tracevar
} {}


test transform-2.1 {transform behaviour, attached read} {
    set tracevar ""
    set                out [memchan]
    puts              $out foobarflabbergast
    seek              $out 0

    transform -attach $out -command identity
    read              $out
    close             $out

    set tracevar
} {}
