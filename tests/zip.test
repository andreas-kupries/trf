# -*- tcl -*-
# Commands covered:  bin
#
# This file contains a collection of tests for one or more of the trf
# commands of the TRF extension. Sourcing this file into Tcl runs the
# tests and generates output for errors.  No output means no errors were
# found.
#
# Copyright (c) 1995 Andreas Kupries (a.kupries@westend.com)
#
# See the file "license.terms" for information on usage and redistribution
# of this file, and for a DISCLAIMER OF ALL WARRANTIES.
#
# $Id$

if {[string compare test [info procs test]] == 1} then {source defs}


# (de) compress "hello, hello!"

set text   "hello, hello!"
set text_c "789CCB48CDC9C9D751C800518A0021700496"
set text_h [text2hex $text]

test zip-1.0 {compress} {

    set in  [text2chan $text]
    set out [memchan]

    fconfigure   $out -translation binary
    hex  -attach $out -mode encode

    zip -mode compress $in $out

    unstack $out
    seek             $out 0
    set data   [read $out]
    close            $out
    close $in

    list $text_h $data
} [list $text_h $text_c]


test zip-1.1 {decompress} {
    set in  [hex2chan $text_c]
    set out [memchan]

    #    fconfigure   $out -translation binary
    #    hex  -attach $out -mode decode

seek $in 0
    zip -mode decompress $in $out

    #    unstack $out
    seek             $out 0
    set data   [read $out]
    close            $out
    close $in

    set data
} $text
